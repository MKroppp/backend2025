# backend2025 - Онлайн библиотека

Проект представляет собой API для онлайн библиотеки, позволяя пользователям регистрироваться, авторизоваться, управлять книгами и добавлять книги в избранное.

Это проект для создания онлайн библиотеки с функционалом авторизации и управления книгами, используя Lumen PHP Framework.

### Основной функционал

1. **Авторизация:**
   - Регистрация с почтой и паролем.
   - Логин с почтой и паролем.
   
2. **Книги:**
   - Просмотр списка всех доступных книг (не требует авторизации).
   - Получение информации по отдельной книге (не требует авторизации).
   - Добавление новой книги (требует логин и роль администратора).
   - Удаление книги (требует логин и роль администратора).
   - Добавление книги в избранное (требует логин).
   - Удаление книги из избранного (требует логин).
   - Выгрузка списка книг в CSV формат (требует роль администратора).

3. **Роли:**
   - Возможность изменять роль пользователя с помощью консольной команды.
   - Доступные роли: Администратор и Клиент.

## Установка

### Требования:
- PHP >= 7.4
- PostgreSQL
- Composer
- Lumen Framework

### Шаги для установки:
1. Клонировать репозиторий:
   ```bash
   git clone https://github.com/MKroppp/backend2025.git

2. Установить зависимости:
   ```bash
    cd backend2025
    composer install

3. Настроить .env файл, указав параметры для подключения к базе данных PostgreSQL.

4. Выполнить миграции:
   ```bash
   php artisan migrate

5. Запустить сервер:
   ```bash
   php -S localhost:8000 -t public

## Проверка с использованием Apidog

Для тестирования API в проекте используется инструмент **Apidog** — удобный клиент для тестирования RESTful API. Apidog позволяет легко создавать запросы, тестировать различные эндпоинты и анализировать ответы.

### Шаги для тестирования с Apidog

1. **Скачайте и установите Apidog:**
   - Перейдите на официальный сайт [Apidog](https://www.apidog.com/) и скачайте подходящую версию для вашей операционной системы.
   - Установите Apidog, следуя инструкциям на сайте.

2. **Импорт проекта API в Apidog:**
   - После установки откройте Apidog.
   - В Apidog создайте новый проект.
   - Настройте проект, указав базовый URL для вашего API (например, `http://localhost:8000`).
   - Теперь вы можете добавить все необходимые запросы (GET, POST, PUT, DELETE) для тестирования API.

3. **Тестирование эндпоинтов:**
   - В Apidog можно настроить различные виды запросов. Например:
     - **GET** запросы для получения списка книг или информации по отдельной книге.
     - **POST** запросы для регистрации пользователя, добавления новой книги или добавления книги в избранное.
     - **DELETE** запросы для удаления книги или удаления книги из избранного.
   - Для авторизации можно отправить **POST** запрос с логином и паролем пользователя. После успешной авторизации в ответе вы получите токен, который нужно использовать для доступа к защищённым эндпоинтам (например, добавление книги, выгрузка в CSV и т.д.).
   - Для защиты эндпоинтов (например, добавление книги, управление ролями) используйте заголовок **Authorization** с полученным токеном.

4. **Тестирование ролей и авторизации:**
   - Для запросов, которые требуют авторизации, перед отправкой запросов убедитесь, что у вас есть действующий токен. В Apidog это можно легко настроить в разделе **Authorization**.
   - Например, при добавлении книги или изменении роли пользователя необходимо передать токен администратора.

5. **Пример запросов:**
   - **GET /books**: Получить список всех доступных книг (не требует авторизации).
   - **GET /books/{id}**: Получить информацию по отдельной книге (не требует авторизации).
   - **POST /register**: Регистрация нового пользователя с почтой и паролем.
   - **POST /login**: Логин пользователя и получение токена.
   - **POST /books**: Добавление новой книги (требует роль администратора).
   - **POST /favorites**: Добавление книги в избранное (требует авторизацию).
   - **DELETE /favorites/{book_id}**: Удаление книги из избранного (требует авторизацию).
